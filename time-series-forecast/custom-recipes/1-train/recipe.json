// This file is the descriptor for the Custom code recipe clean
// WORK IN PROGRESS
{
    // Meta data for display purposes
    "meta" : {
        "label" : "1. Forecast - train",
        "description" : "Train forecasting models on historical data",
        "icon" : "icon-beaker"
    },

    "kind" : "R",
    
    "selectableFromDataset" : "input_dataset",
    

    // Inputs and outputs are defined by roles. In the recipe's I/O tab, the user can associate one
    // or more dataset to each input and output role.

    // The "arity" field indicates whether the user can associate several datasets to the role ('NARY')
    // or at most one ('UNARY'). The "required" field indicates whether the user is allowed to
    // associate no dataset with the role.

    "inputRoles" : [
        {
            "name": "input_dataset",
            "label": "Input dataset",
            "description": "Must include one date and one numerical column",
            "arity": "UNARY",
            "required": true,
            "acceptsDataset": true,
            "acceptsFolder": false
        }
    ],

    "outputRoles" : [
        {
            "name": "output_folder",
            "label": "Output folder",
            "description": "Will store trained R forecast models",
            "arity": "UNARY",
            "required": true,
            "acceptsDataset": false,
            "acceptsManagedFolder": true,
            "mustBeStrictlyType": "Filesystem"
        } 
        // ...
    ],

    // The field "params" holds a list of all the params
    // for wich the user will be prompted for values in the Settings tab of the recipe.

    // The available parameter types are:
    // STRING, INT, DOUBLE, BOOLEAN, PASSWORD, SELECT, MAP, COLUMN, COLUMNS, TEXTAREA

    "params": [
        
        {
            "name": "separator_preprocessing",
            "label": "Preprocessing",
            "type": "SEPARATOR"
        },
        

        {
            "name": "TIME_COLUMN",
            "label" : "Time column",
            "description":"Must be a parsed date",
            "type": "COLUMN",
            "columnRole":"input_dataset",
            "mandatory" : true
        },
        
        {
            "name": "SERIES_COLUMN",
            "label" : "Series column",
            "description":"Must be numeric",
            "type": "COLUMN",
            "columnRole":"input_dataset",
            "mandatory" : true
        },
        
        // A "SELECT" parameter is a multi-choice selector. Choices are specified using the selectChoice field
        {
            "name": "CHOSEN_GRANULARITY",
            "label" : "Granularity",
            "description": "Period of the observations",
            "type": "SELECT",
            "mandatory" : true,
            "selectChoices": [
                {
                    "value": "year",
                    "label": "Year"
                },
                {
                    "value": "quarter",
                    "label": "Quarter"
                },
                {
                    "value": "month",
                    "label": "Month"
                },
                {
                    "value": "week",
                    "label": "Week"
                },
                {
                    "value": "day",
                    "label": "Day"
                },
                {
                    "value": "hour",
                    "label": "Hour"
                },
            ]
        },
        
        {
            "name": "TIMEZONE",
            "label" : "Time zone",
            "type": "STRING",
            "description":"Follow ISO 8601 standard (default is UTC)",
            "defaultValue" : "UTC",
            "mandatory" : false
        },
        
        {
            "name": "BOX_COX_TRANSFORMATION_ACTIVATED",
            "label" : "Box-Cox transformation",
            "description": "Adjust raw time series before forecasting with Box-Cox transformation (recommended)",
            "type": "BOOLEAN",
            "defaultValue" : true,
            "mandatory" : true
        },

        {
            "name": "separator_modeling",
            "label": "Training forecasting models - select which to apply",
            "type": "SEPARATOR"
        },
        
        {
            "name": "NAIVE_MODEL_ACTIVATED",
            "label" : "Naive model (baseline)",
            "description": "Based on the naive/snaive implementation in R \"forecast\" package",
            "type": "BOOLEAN",
            "defaultValue" : true,
            "mandatory" : true
        },
        
        {
            "name": "NAIVE_MODEL_METHOD",
            "label" : "\u21B3 method",
            "description": "cf. otexts.org/fpp2/simple-methods.html",
            "type": "SELECT",
            "mandatory" : false,
            "defaultValue": "simple",
            "visibilityCondition": "model.NAIVE_MODEL_ACTIVATED",
            "selectChoices": [
                {
                    "value": "simple",
                    "label": "No seasonality - forecast preceding value"
                },
                {
                    "value": "seasonal",
                    "label": "Seasonality - forecast value at previous period"
                },
                {
                    "value": "drift",
                    "label": "Seasonality - forecast value at previous period with drift correction"
                }
            ]
        },
        
        {
            "name": "SEASONALTREND_MODEL_ACTIVATED",
            "label" : "Seasonal Trend model",
            "description": "Based on the ets/stlf implementation in R \"forecast\" package",
            "type": "BOOLEAN",
            "defaultValue" : false,
            "mandatory" : true
        },
        
        {
            "name": "SEASONALTREND_MODEL_ERROR_TYPE",
            "label" : "\u21B3 error type",
            "type": "SELECT",
            "mandatory" : false,
            "defaultValue": "Z",
            "visibilityCondition": "model.SEASONALTREND_MODEL_ACTIVATED",
            "selectChoices": [
                {
                    "value": "Z",
                    "label": "Automatically selected"
                },
                {
                    "value": "N",
                    "label": "None"
                },
                {
                    "value": "A",
                    "label": "Additive"
                },
                {
                    "value": "M",
                    "label": "Multiplicative"
                }
            ]
        },
        
        {
            "name": "SEASONALTREND_MODEL_TREND_TYPE",
            "label" : "\u21B3 trend type",
            "type": "SELECT",
            "mandatory" : false,
            "defaultValue": "Z",
            "visibilityCondition": "model.SEASONALTREND_MODEL_ACTIVATED",
            "selectChoices": [
                {
                    "value": "Z",
                    "label": "Automatically selected"
                },
                {
                    "value": "N",
                    "label": "None"
                },
                {
                    "value": "A",
                    "label": "Additive"
                },
                {
                    "value": "M",
                    "label": "Multiplicative"
                }
            ]
        },
        
        {
            "name": "SEASONALTREND_MODEL_SEASONALITY_TYPE",
            "label" : "\u21B3 seasonality type",
            "type": "SELECT",
            "mandatory" : false,
            "defaultValue": "Z",
            "visibilityCondition": "model.SEASONALTREND_MODEL_ACTIVATED",
            "selectChoices": [
                {
                    "value": "Z",
                    "label": "Automatically selected"
                },
                {
                    "value": "N",
                    "label": "None"
                },
                {
                    "value": "A",
                    "label": "Additive"
                },
                {
                    "value": "M",
                    "label": "Multiplicative"
                }
            ]
        },
        
       {
            "name": "SEASONALTREND_MODEL_KWARGS",
            "type": "MAP",
            "label" : "\u21B3 additional parameters",
            "description":"Optional additional parameters cf. www.rdocumentation.org/packages/forecast/versions/8.3/topics/ets",
            "visibilityCondition": "model.SEASONALTREND_MODEL_ACTIVATED",
            "mandatory" : false
        },
        
        {
            "name": "NEURALNETWORK_MODEL_ACTIVATED",
            "label" : "Neural Network model",
            "description": "Based on the nnetar implementation in R \"forecast\" package",
            "type": "BOOLEAN",
            "defaultValue" : false,
            "mandatory" : true
        },
        
        {
            "name": "NEURALNETWORK_MODEL_NUMBER_SEASONAL_LAGS",
            "label" : "\u21B3 seasonal lags",
            "description": "Number of seasonal lags used as inputs. Default is 1.",
            "type": "INT",
            "mandatory" : false,
            "defaultValue" : 1,
            "visibilityCondition": "model.NEURALNETWORK_MODEL_ACTIVATED"
        },

        {
            "name": "NEURALNETWORK_MODEL_NUMBER_NON_SEASONAL_LAGS",
            "label" : "\u21B3 non-seasonal lags",
            "description": "Number of non-seasonal lags used as inputs. Leave -1 for automatic selection.",
            "type": "INT",
            "mandatory" : false,
            "defaultValue" : -1,
            "visibilityCondition": "model.NEURALNETWORK_MODEL_ACTIVATED"
        },
        
        {
            "name": "NEURALNETWORK_MODEL_SIZE",
            "label" : "\u21B3 number of neurons",
            "description": "Number of neurons in the hidden layer. Leave -1 for automatic selection.",
            "type": "INT",
            "mandatory" : false,
            "defaultValue" : -1,
            "visibilityCondition": "model.NEURALNETWORK_MODEL_ACTIVATED"
        },
               
        {
            "name": "NEURALNETWORK_MODEL_KWARGS",
            "type": "MAP",
            "label" : "\u21B3 additional parameters",
            "description":"Optional additional parameters cf. www.rdocumentation.org/packages/forecast/versions/8.3/topics/nnetar",
            "visibilityCondition": "model.NEURALNETWORK_MODEL_ACTIVATED",
            "mandatory" : false
        },
        
        {
            "name": "ARIMA_MODEL_ACTIVATED",
            "label" : "ARIMA model",
            "description": "Based on the auto.arima implementation in R \"forecast\" package. \
                            WARNING: not suitable for long time series",
            "type": "BOOLEAN",
            "defaultValue" : false,
            "mandatory" : true
        },
        
        {
            "name": "ARIMA_MODEL_STEPWISE_ACTIVATED",
            "label" : "\u21B3 stepwise",
            "description": "Use stepwise procedure to speed up the search for model parameters",
            "type": "BOOLEAN",
            "defaultValue" : true,
            "mandatory" : false,
            "visibilityCondition": "model.ARIMA_MODEL_ACTIVATED"
        },

        {
            "name": "ARIMA_MODEL_KWARGS",
            "type": "MAP",
            "label" : "\u21B3  additional parameters",
            "description":"Optional additional parameters cf. www.rdocumentation.org/packages/forecast/versions/8.3/topics/auto.arima",
            "visibilityCondition": "model.ARIMA_MODEL_ACTIVATED",
            "mandatory" : false
        },

        {
            "name": "STATE_SPACE_MODEL_ACTIVATED",
            "label" : "State Space model",
            "description": "Based on the tbats implementation in R \"forecast\" package. \
                             WARNING: not suitable for long time series",
            "type": "BOOLEAN",
            "defaultValue" : false,
            "mandatory" : true
        },

        {
            "name": "STATESPACE_MODEL_KWARGS",
            "type": "MAP",
            "label" : "\u21B3  additional parameters",
            "description":"Optional additional parameters cf. www.rdocumentation.org/packages/forecast/versions/8.3/topics/tbats",
            "visibilityCondition": "model.STATE_SPACE_MODEL_ACTIVATED",
            "mandatory" : false
        }
        
    ],

    // The field "resourceKeys" holds a list of keys that allows to limit the number
    // of concurrent executions and activities triggered by this recipe.
    //
    // Administrators can configure the limit per resource key in the Administration > Settings > Flow build
    // screen.

    "resourceKeys" : []

}
